IF OPEN:S <> 0
  * RESTORE OLD LOCK VALUE
  POKE 64,LOCK:S
  * CLOSE OLD FILE
  USE
  * FLAG FILE CLOSED
  STORE 0 TO OPEN:S
  * RESET DISK SYSTEM TO WRITE OUT DATA FOR FILE CLOSE
  RESET &DBFDRIVE:S
ENDIF
STORE '&DBFDRIVE:S'+'&USEFILE' TO USETEMP
IF $(USEFILE,1,1) <> ' '
  * OPEN FILE IF A FILENAME WAS SPECIFIED
  STORE -1 TO LOCK:S
  DO WHILE LOCK:S <> 0
    RESET &DBFDRIVE:S
    * OPEN FILE FOR READ/WRITE
    POKE 65,90
    USE &USETEMP
    * SAVE LOCK STATUS
    STORE PEEK(64) TO LOCK:S
    IF LOCK:S <> 0
      ? 'FILE LOCKED - PLEASE WAIT'
      ? 'PRESS RETURN TO TRY AGAIN'
      ? 'PRESS ESCAPE TO CANCEL DO'
      POKE 64,LOCK:S
      USE
      * WAIT FOR KEYPRESS, THEN TRY TO OPEN FILE AGAIN
      WAIT
    ENDIF
    * REPEAT UNTIL FILE ACCESS IS GRANTED
  ENDDO
  STORE -1 TO OPEN:S
ENDIF
RELEASE USETEMP
